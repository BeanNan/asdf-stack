#!/bin/bash
get_tags() {
  local CURL="curl -s"
  if [ -n "$GITHUB_API_TOKEN" ]; then
    CURL="$CURL -H 'Authorization: token $GITHUB_API_TOKEN'"
  fi
  $CURL https://api.github.com/repos/commercialhaskell/stack/tags
}

filter_versions() {
 grep -oE '[[:digit:]](\.[[:digit:]]+){2}(-[[:alnum:]]+|\.[[:digit:]]+)?'
}

join_lines() {
  tr '\n' ' '
}

get_tags | filter_versions | uniq | join_lines
